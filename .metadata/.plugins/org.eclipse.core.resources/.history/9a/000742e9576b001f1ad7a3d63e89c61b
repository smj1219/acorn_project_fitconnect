<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ExerciseJournal">
	<sql id="column">
		e_journal_id, m_calendar_id, exercise_id, exercise_order, exercise_set, exercise_count, exercise_weight, TO_CHAR(duration, 'YYYY.MM.DD') as duration
	</sql>
	
	<select id="getExerListTainer" resultType="com.example.fitconnect.dto.ExerciseJournalDto" parameterType="com.example.fitconnect.dto.ExerciseJournalDto">
		SELECT result2.*, memberinfo.member_num
		FROM
		   (SELECT result1.*, membercalendar.m_calendar_id, TO_CHAR(regdate, 'YYYY-MM-DD') as regdate, member_num
		   FROM
		       (SELECT ej.e_journal_id, ej.m_calendar_id, ej.exercise_id, ej.exercise_order, ej.exercise_set, 
		       ej.exercise_count, ej.exercise_weight, TO_CHAR(ej.duration, 'YYYY-MM-DD') as duration, el.exercise_name, el.exercise_image
		       FROM exercisejournal ej
		       JOIN exerciselist el ON ej.exercise_id = el.exercise_id
		       ORDER BY ej.exercise_order ASC) result1
		   JOIN membercalendar ON membercalendar.m_calendar_id = result1.m_calendar_id) result2
		JOIN memberinfo ON result2.regdate = TO_CHAR(SYSDATE, 'YYYY-MM-DD')
		WHERE member_num =#{memberNum};
				
	</select>
	<select id="getExerListMember" resultType="com.example.fitconnect.dto.ExerciseJournalDto" parameterType="com.example.fitconnect.dto.ExerciseJournalDto">
		SELECT ej.e_journal_id, ej.m_calendar_id, ej.exercise_id, ej.exercise_order, ej.exercise_set, ej.exercise_count, ej.exercise_weight, 
		TO_CHAR(duration, 'YYYY.MM.DD') as duration, el.exercise_name, el.exercise_image
		FROM exercisejournal ej, exerciselist el
		WHERE ej.exercise_id=ej.exercise_id
		AND m_calendar_id=#{calendarId}
				
	</select>
	<select id="getExerOne" resultType="com.example.fitconnect.dto.ExerciseJournalDto" parameterType="int">
		SELECT <include refid="column"/>
		FROM exercisejournal
		WHERE e_journal_id=#{journalId}
	
	</select>
	<insert id="insert" parameterType="com.example.fitconnect.dto.ExerciseJournalDto">
		INSERT INTO exercisejournal
		(e_journal_id, exercise_id, exercise_order, exercise_set, exercise_count, exercise_weight, duration)
		VALUES(exercisejournal_seq.NEXTVAL, #{exerciseId}, #{exerciseOrder}, #{exerciseSet}, #{exerciseCount}, #{exerciseWeight}, SYSDATE)
	</insert>
	<update id="update" parameterType="com.example.fitconnect.dto.ExerciseJournalDto">
		UPDATE exercisejournal
		SET exercise_id=#{exerciseId}, exercise_order=#{exerciseOrder}, exercise_set=#{exerciseSet}, exercise_count=#{exerciseCount}, 
		exercise_weight=#{exerciseWeight}
		WHERE e_journal_id=#{journalId}
	</update>
	<delete id="delete" parameterType="int">
		DELETE FROM exercisejournal
		WHERE e_journal_id=#{journalId}
	</delete>

</mapper>